
name: "RocketChat Cuida News ðŸŽ‰"

on:
  release:
    types: [published, created, edited]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
    - name: Dump GitHub context
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: echo "$GITHUB_CONTEXT"
    
    - name: Send notification to Rocket.Chat
      env:
        WEBHOOK_URL: ${{ secrets.ROCKETCHAT_WEBHOOK }}
        RELEASE_TAG: ${{ github.event.release.tag_name }}
        RELEASE_URL: ${{ github.event.release.html_url }}
      run: |
        curl -X POST -H 'Content-Type: application/json' --data "{\"text\":\"Nova release criada: ${RELEASE_TAG}\nLink: ${RELEASE_URL}\"}" ${WEBHOOK_URL}
    
    - name: Output curl result
      if: failure()
      run: echo "Falha ao enviar notificaÃ§Ã£o. Verifique se o webhook do Rocket.Chat estÃ¡ configurado corretamente."